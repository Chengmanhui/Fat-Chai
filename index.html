<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LifeTracker for Fat Boy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; -webkit-tap-highlight-color: transparent; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        .tab-btn.active { color: #0ea5e9; }
        .tab-btn.active svg { stroke-width: 2.5; }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "lucide-react": "https://esm.sh/lucide-react@^0.560.0",
    "react/": "https://esm.sh/react@^19.2.3/",
    "recharts": "https://esm.sh/recharts@^3.5.1"
  }
}
</script>
</head>
<body class="text-slate-800">

    <!-- Header -->
    <header class="sticky top-0 z-50 bg-white/80 backdrop-blur-md border-b border-pink-100 shadow-sm">
        <div class="max-w-md mx-auto px-4 py-4 flex justify-between items-center">
            <button onclick="router.navigate('summary')" class="text-xl font-bold bg-gradient-to-r from-pink-400 to-sky-400 bg-clip-text text-transparent">
                LifeTracker
            </button>
            <div class="w-8 h-8 rounded-full bg-gradient-to-br from-pink-200 to-sky-200 flex items-center justify-center text-xs font-bold text-white shadow-inner">
                FB
            </div>
        </div>
        <div id="alert-banner" class="hidden bg-red-500 text-white px-4 py-2 text-sm text-center animate-pulse"></div>
    </header>

    <!-- Main Content Area -->
    <main id="app" class="flex-1 w-full max-w-md mx-auto p-4 pb-24 min-h-screen"></main>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-sky-100 pb-safe z-40">
        <div class="max-w-md mx-auto flex justify-around items-center h-16 px-1" id="nav-container">
            <!-- Nav items injected by JS -->
        </div>
    </nav>

    <script>
        // --- 1. STATE MANAGEMENT ---
        const DB_KEYS = {
            TAB: 'active_tab',
            WEIGHT: 'weight_logs',
            DIET: 'diet_logs',
            EXERCISE: 'exercise_logs',
            MONEY: 'money_logs',
            BANK: 'bank_ponds'
        };

        const store = {
            data: {
                activeTab: localStorage.getItem(DB_KEYS.TAB) || 'summary',
                weightLogs: JSON.parse(localStorage.getItem(DB_KEYS.WEIGHT) || '[]'),
                dietLogs: JSON.parse(localStorage.getItem(DB_KEYS.DIET) || '[]'),
                exerciseLogs: JSON.parse(localStorage.getItem(DB_KEYS.EXERCISE) || '[]'),
                transactions: JSON.parse(localStorage.getItem(DB_KEYS.MONEY) || '[]'),
                ponds: JSON.parse(localStorage.getItem(DB_KEYS.BANK) || '[]')
            },
            save(key, value) {
                this.data[key] = value;
                localStorage.setItem(DB_KEYS[key.toUpperCase().replace('LOGS', '').replace('PONDS', 'BANK').replace('ACTIVETAB', 'TAB')], typeof value === 'string' ? value : JSON.stringify(value));
                render();
            }
        };

        // --- 2. HELPERS & CONSTANTS ---
        const SauceAmount = { NONE: 'None', LITTLE: 'Little', MODERATE: 'Moderate', LARGE: 'Large' };
        const Currency = { HKD: 'HKD', GBP: 'GBP' };
        const TransactionType = { INCOME: 'Income', EXPENSE: 'Expense' };
        const ExpenseCategory = { MEALS: 'Meals', TRANSPORT: 'Transport', ACCOMMODATION: 'Accommodation', TRAVELLING: 'Travelling', LEISURE: 'Leisure', BACK_HOME: 'Back Home' };
        const IncomeCategory = { POCKET_MONEY: 'Pocket Money', PART_TIME: 'Part Time', INTEREST: 'Interest', OTHER: 'Other' };
        const EXCHANGE_RATE = 0.1;

        const formatDate = (iso) => new Date(iso).toLocaleDateString('en-GB', { day: 'numeric', month: 'short' });
        const formatCurrency = (val) => '¬£' + val.toFixed(0);

        // --- 3. RENDERERS ---

        const router = {
            navigate(tab) {
                store.save('activeTab', tab);
            }
        };

        function renderNav() {
            const tabs = [
                { id: 'summary', icon: 'home', label: 'Home' },
                { id: 'weight', icon: 'activity', label: 'Weight' },
                { id: 'diet', icon: 'apple', label: 'Diet' },
                { id: 'exercise', icon: 'bar-chart-2', label: 'Exercise' },
                { id: 'money', icon: 'wallet', label: 'Money' },
                { id: 'bank', icon: 'landmark', label: 'Bank' },
            ];
            
            const html = tabs.map(tab => `
                <button onclick="router.navigate('${tab.id}')" class="tab-btn flex flex-col items-center justify-center w-full h-full transition-colors text-slate-400 hover:text-sky-300 ${store.data.activeTab === tab.id ? 'active text-sky-500' : ''}">
                    <i data-lucide="${tab.icon}" width="20" height="20"></i>
                    <span class="text-[10px] mt-1 font-medium truncate max-w-full px-1">${tab.label}</span>
                </button>
            `).join('');
            
            document.getElementById('nav-container').innerHTML = html;
        }

        function renderAlert() {
            const el = document.getElementById('alert-banner');
            if (store.data.weightLogs.length > 0) {
                const last = new Date(store.data.weightLogs[0].date).getTime();
                const diff = (Date.now() - last) / (86400000);
                if (diff > 3) {
                    el.textContent = "‚ö†Ô∏è It's been over 3 days! Please weigh yourself.";
                    el.classList.remove('hidden');
                    return;
                }
            }
            el.classList.add('hidden');
        }

        // --- VIEW: SUMMARY ---
        function getSummaryHTML() {
            const currentMonth = new Date().getMonth();
            
            // Calc stats
            const mins = store.data.exerciseLogs
                .filter(l => new Date(l.date).getMonth() === currentMonth)
                .reduce((a, b) => a + b.durationMinutes, 0);

            const healthy = store.data.dietLogs
                .filter(l => new Date(l.date).getMonth() === currentMonth)
                .filter(l => l.vegetableBowls >= 1 && (l.sauce === 'None' || l.sauce === 'Little') && !l.hasColdDrink && !l.hasSugarDrink)
                .length;
            
            const totalDiet = store.data.dietLogs.filter(l => new Date(l.date).getMonth() === currentMonth).length;

            const money = store.data.transactions.filter(l => new Date(l.date).getMonth() === currentMonth);
            const inc = money.filter(t => t.type === 'Income').reduce((a, b) => a + b.amount, 0);
            const exp = money.filter(t => t.type === 'Expense').reduce((a, b) => a + b.amount, 0);

            const weight = store.data.weightLogs.length ? store.data.weightLogs[0].weight : 'N/A';

            return `
                <div class="space-y-4">
                    <div class="bg-gradient-to-br from-pink-400 to-pink-500 rounded-2xl p-6 text-white shadow-lg shadow-pink-200">
                        <h2 class="text-2xl font-bold mb-1">Hello, Fat Boy!</h2>
                        <p class="opacity-90">Keep pushing your limits this month.</p>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-100">
                            <p class="text-slate-400 text-xs font-bold uppercase">Weight</p>
                            <p class="text-2xl font-bold text-slate-700">${weight} <span class="text-sm">kg</span></p>
                        </div>
                        <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-100">
                            <p class="text-slate-400 text-xs font-bold uppercase">Active Mins</p>
                            <p class="text-2xl font-bold text-sky-500">${mins}</p>
                        </div>
                        <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-100">
                            <p class="text-slate-400 text-xs font-bold uppercase">Healthy Meals</p>
                            <p class="text-2xl font-bold text-green-500">${healthy} <span class="text-sm text-slate-400">/ ${totalDiet}</span></p>
                        </div>
                        <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-100">
                            <p class="text-slate-400 text-xs font-bold uppercase">Savings</p>
                            <p class="text-2xl font-bold text-indigo-500">¬£${(inc - exp).toFixed(0)}</p>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                        <h3 class="font-bold text-slate-700 mb-2">Mom's Message</h3>
                        <p class="text-slate-500 italic text-sm">"Remember to eat more vegetables and save money for your future! Love you!"</p>
                    </div>
                </div>
            `;
        }

        // --- VIEW: WEIGHT ---
        function renderWeightChart(logs) {
            if (!logs.length) return '';
            const data = [...logs].sort((a,b) => new Date(a.date) - new Date(b.date)).slice(-10);
            const max = Math.max(...data.map(d => d.weight)) + 2;
            const min = Math.min(...data.map(d => d.weight)) - 2;
            const range = max - min;
            const width = 300; 
            const height = 150;
            
            const points = data.map((d, i) => {
                const x = (i / (data.length - 1 || 1)) * width;
                const y = height - ((d.weight - min) / range) * height;
                return `${x},${y}`;
            }).join(' ');

            return `
                <svg width="100%" height="100%" viewBox="0 0 ${width} ${height}" overflow="visible">
                    <defs>
                        <linearGradient id="grad" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#f472b6;stop-opacity:0.2" />
                            <stop offset="100%" style="stop-color:#f472b6;stop-opacity:0" />
                        </linearGradient>
                    </defs>
                    <path d="M0,${height} ${points} ${width},${height}" fill="url(#grad)" stroke="none" />
                    <polyline fill="none" stroke="#f472b6" stroke-width="3" points="${points}" />
                    ${data.map((d, i) => {
                        const x = (i / (data.length - 1 || 1)) * width;
                        const y = height - ((d.weight - min) / range) * height;
                        return `<circle cx="${x}" cy="${y}" r="4" fill="#f472b6" />`;
                    }).join('')}
                </svg>
            `;
        }

        function getWeightHTML() {
            const logs = store.data.weightLogs.sort((a,b) => new Date(b.date) - new Date(a.date));
            const chartSVG = renderWeightChart(logs);

            return `
                <div class="space-y-6">
                    <div class="bg-white rounded-2xl p-6 shadow-sm border border-pink-100">
                        <h2 class="text-lg font-bold text-slate-700 mb-4">Record Weight</h2>
                        <form onsubmit="handleWeightSubmit(event)" class="flex gap-3">
                            <div class="relative flex-1">
                                <input name="weight" type="number" step="0.1" min="0" placeholder="0.0" class="w-full pl-4 pr-12 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-300" required />
                                <span class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 font-medium">kg</span>
                            </div>
                            <button type="submit" class="bg-pink-400 hover:bg-pink-500 text-white p-3 rounded-xl shadow-lg shadow-pink-200"><i data-lucide="plus"></i></button>
                        </form>
                    </div>

                    ${logs.length ? `
                    <div class="bg-white rounded-2xl p-6 shadow-sm border border-sky-100">
                         <h3 class="text-md font-semibold text-slate-600 mb-4">Progress</h3>
                         <div class="h-48 w-full p-2">${chartSVG}</div>
                    </div>` : ''}

                    <div class="space-y-3">
                        <h3 class="text-sm font-semibold text-slate-500 uppercase tracking-wider ml-1">History</h3>
                        ${logs.map(l => `
                            <div class="bg-white p-4 rounded-xl shadow-sm flex justify-between items-center border border-slate-50">
                                <div>
                                    <p class="text-lg font-bold text-slate-700">${l.weight} <span class="text-sm font-normal text-slate-400">kg</span></p>
                                    <p class="text-xs text-slate-400">${new Date(l.date).toLocaleString()}</p>
                                </div>
                                <button onclick="deleteLog('weightLogs', '${l.id}')" class="text-slate-300 hover:text-red-400"><i data-lucide="trash-2" width="18"></i></button>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function handleWeightSubmit(e) {
            e.preventDefault();
            const val = parseFloat(e.target.weight.value);
            if(!val) return;
            store.save('weightLogs', [{ id: Date.now().toString(), date: new Date().toISOString(), weight: val }, ...store.data.weightLogs]);
        }

        // --- VIEW: DIET ---
        function getDietHTML() {
            const logs = store.data.dietLogs.sort((a,b) => new Date(b.date) - new Date(a.date));
            return `
                <div class="space-y-6">
                    <div class="bg-white rounded-2xl p-6 shadow-sm border border-sky-100">
                        <h2 class="text-lg font-bold text-slate-700 mb-4">Log Meal</h2>
                        <form onsubmit="handleDietSubmit(event)" class="space-y-5">
                            <div class="space-y-2">
                                <label class="text-sm font-medium text-slate-600">Vegetable Bowls</label>
                                <div class="flex gap-2">
                                    ${[0, 0.5, 0.75, 1, 2].map(n => `<label class="flex-1 cursor-pointer"><input type="radio" name="veg" value="${n}" class="peer hidden" ${n===1?'checked':''}> <div class="py-2 text-center rounded-lg bg-slate-50 peer-checked:bg-sky-400 peer-checked:text-white text-sm font-bold transition-all">${n}</div></label>`).join('')}
                                </div>
                            </div>
                            <div class="space-y-2">
                                <label class="text-sm font-medium text-slate-600">Sauce Amount</label>
                                <div class="grid grid-cols-2 gap-2">
                                    ${Object.values(SauceAmount).map(s => `<label class="cursor-pointer"><input type="radio" name="sauce" value="${s}" class="peer hidden" ${s==='Moderate'?'checked':''}> <div class="py-2 text-center rounded-lg bg-slate-50 peer-checked:bg-pink-400 peer-checked:text-white text-sm font-medium transition-all">${s}</div></label>`).join('')}
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <label class="cursor-pointer"><input type="checkbox" name="cold" class="peer hidden"> <div class="p-3 rounded-xl border-2 border-slate-100 peer-checked:border-sky-400 peer-checked:bg-sky-50 peer-checked:text-sky-600 text-slate-400 text-center font-bold transition-all">Cold Drink</div></label>
                                <label class="cursor-pointer"><input type="checkbox" name="sugar" class="peer hidden"> <div class="p-3 rounded-xl border-2 border-slate-100 peer-checked:border-pink-400 peer-checked:bg-pink-50 peer-checked:text-pink-600 text-slate-400 text-center font-bold transition-all">Sugar Drink</div></label>
                            </div>
                            <button type="submit" class="w-full bg-slate-800 text-white py-3 rounded-xl font-semibold shadow-lg">Save Meal</button>
                        </form>
                    </div>
                    <div class="space-y-3">
                        ${logs.map(l => {
                            let score = 0;
                            if(l.vegetableBowls >=1) score++;
                            if(l.sauce === 'None' || l.sauce === 'Little') score++;
                            if(!l.hasColdDrink) score++;
                            if(!l.hasSugarDrink) score++;
                            const color = score === 4 ? 'bg-green-100 border-green-200' : score >= 2 ? 'bg-yellow-50 border-yellow-100' : 'bg-red-50 border-red-100';
                            return `
                                <div class="p-4 rounded-xl shadow-sm border ${color} flex justify-between items-start">
                                    <div class="space-y-1">
                                        <p class="text-xs text-slate-400">${new Date(l.date).toLocaleString()}</p>
                                        <div class="flex flex-wrap gap-2 text-sm text-slate-700">
                                            <span class="font-medium bg-white/50 px-2 py-0.5 rounded">ü•ó ${l.vegetableBowls} bowls</span>
                                            <span class="font-medium bg-white/50 px-2 py-0.5 rounded">üßÇ ${l.sauce}</span>
                                        </div>
                                        <div class="flex gap-2 mt-1">
                                            ${l.hasColdDrink ? '<span class="text-xs bg-sky-100 text-sky-600 px-2 py-0.5 rounded-full">Cold Drink</span>' : ''}
                                            ${l.hasSugarDrink ? '<span class="text-xs bg-pink-100 text-pink-600 px-2 py-0.5 rounded-full">Sugar Drink</span>' : ''}
                                            ${!l.hasColdDrink && !l.hasSugarDrink ? '<span class="text-xs bg-green-100 text-green-600 px-2 py-0.5 rounded-full">Healthy Drink Choice</span>' : ''}
                                        </div>
                                    </div>
                                    <button onclick="deleteLog('dietLogs', '${l.id}')" class="text-slate-300 hover:text-slate-500"><i data-lucide="trash-2" width="16"></i></button>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        function handleDietSubmit(e) {
            e.preventDefault();
            const form = e.target;
            const log = {
                id: Date.now().toString(),
                date: new Date().toISOString(),
                vegetableBowls: parseFloat(form.veg.value),
                sauce: form.sauce.value,
                hasColdDrink: form.cold.checked,
                hasSugarDrink: form.sugar.checked
            };
            store.save('dietLogs', [log, ...store.data.dietLogs]);
        }

        // --- VIEW: EXERCISE ---
        function getExerciseHTML() {
            const logs = store.data.exerciseLogs;
            const totalMins = logs.reduce((a,b)=>a+b.durationMinutes,0);
            
            return `
                <div class="space-y-6">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-sky-500 text-white p-4 rounded-2xl shadow-lg shadow-sky-200">
                            <p class="text-sky-100 text-xs font-medium uppercase">Total Time</p>
                            <p class="text-3xl font-bold mt-1">${totalMins}<span class="text-sm font-normal text-sky-200 ml-1">mins</span></p>
                        </div>
                        <div class="bg-pink-500 text-white p-4 rounded-2xl shadow-lg shadow-pink-200">
                            <p class="text-pink-100 text-xs font-medium uppercase">Sessions</p>
                            <p class="text-3xl font-bold mt-1">${logs.length}<span class="text-sm font-normal text-pink-200 ml-1">count</span></p>
                        </div>
                    </div>
                    <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-100">
                        <h2 class="text-lg font-bold text-slate-700 mb-4">Log Workout</h2>
                        <form onsubmit="handleExerciseSubmit(event)" class="space-y-5">
                            <div class="space-y-2">
                                <label class="text-sm font-medium text-slate-600">Activity</label>
                                <div class="flex flex-wrap gap-2">
                                    ${['Running', 'Gym', 'Ball Games', 'Swimming', 'Cycling', 'Yoga'].map(t => `<label><input type="radio" name="type" value="${t}" class="peer hidden" ${t==='Gym'?'checked':''}> <div class="px-3 py-1.5 rounded-full text-xs font-semibold border border-slate-200 text-slate-500 peer-checked:bg-slate-800 peer-checked:text-white peer-checked:border-slate-800 transition-all">${t}</div></label>`).join('')}
                                </div>
                            </div>
                            <div class="space-y-2">
                                <label class="text-sm font-medium text-slate-600">Intensity</label>
                                <div class="flex bg-slate-100 p-1 rounded-xl">
                                    ${['Low', 'Medium', 'High'].map(l => `<label class="flex-1"><input type="radio" name="intensity" value="${l}" class="peer hidden" ${l==='Medium'?'checked':''}> <div class="py-2 text-center rounded-lg text-sm font-bold text-slate-400 peer-checked:bg-${l==='High'?'red':l==='Medium'?'orange':'green'}-400 peer-checked:text-white transition-all">${l}</div></label>`).join('')}
                                </div>
                            </div>
                            <div class="space-y-2">
                                <label class="text-sm font-medium text-slate-600">Duration (mins)</label>
                                <input name="duration" type="number" value="30" class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-sky-300" required />
                            </div>
                            <button type="submit" class="w-full bg-gradient-to-r from-sky-400 to-pink-400 text-white py-3 rounded-xl font-bold shadow-lg shadow-pink-100">Log Session</button>
                        </form>
                    </div>
                    <div class="space-y-3">
                        ${logs.map(l => `
                            <div class="bg-white p-4 rounded-xl shadow-sm flex justify-between items-center border-l-4 border-l-sky-400">
                                <div>
                                    <div class="flex items-center gap-2">
                                        <span class="font-bold text-slate-700">${l.type}</span>
                                        <span class="text-[10px] px-2 py-0.5 rounded-full text-white ${l.intensity === 'High' ? 'bg-red-400' : l.intensity === 'Medium' ? 'bg-orange-400' : 'bg-green-400'}">${l.intensity}</span>
                                    </div>
                                    <p class="text-sm text-slate-500 mt-1">${l.durationMinutes} mins ‚Ä¢ ${new Date(l.date).toLocaleDateString()}</p>
                                </div>
                                <button onclick="deleteLog('exerciseLogs', '${l.id}')" class="text-slate-300 hover:text-red-400"><i data-lucide="trash-2" width="18"></i></button>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function handleExerciseSubmit(e) {
            e.preventDefault();
            const form = e.target;
            store.save('exerciseLogs', [{
                id: Date.now().toString(),
                date: new Date().toISOString(),
                type: form.type.value,
                intensity: form.intensity.value,
                durationMinutes: parseInt(form.duration.value)
            }, ...store.data.exerciseLogs]);
        }

        // --- VIEW: MONEY ---
        let moneyViewMode = 'month'; // 'month' or 'year'
        let moneyViewDate = new Date();
        let moneyTab = 'log'; // 'log' or 'vis'
        let moneyTransType = 'Expense'; // 'Expense' or 'Income'
        let moneyCategory = 'Meals';

        function getMoneyHTML() {
            // Filter
            const filtered = store.data.transactions.filter(t => {
                const d = new Date(t.date);
                if (moneyViewMode === 'month') return d.getMonth() === moneyViewDate.getMonth() && d.getFullYear() === moneyViewDate.getFullYear();
                return d.getFullYear() === moneyViewDate.getFullYear();
            });

            const income = filtered.filter(t => t.type === 'Income').reduce((s,t) => s+t.amount, 0);
            const expense = filtered.filter(t => t.type === 'Expense').reduce((s,t) => s+t.amount, 0);
            const balance = income - expense;

            const cats = moneyTransType === 'Income' ? IncomeCategory : ExpenseCategory;

            return `
                <div class="space-y-6">
                    <div class="flex flex-col gap-3">
                         <div class="flex justify-end">
                            <div class="bg-slate-100 p-1 rounded-lg flex text-xs font-medium">
                                <button onclick="setMoneyViewMode('month')" class="px-3 py-1 rounded-md transition-all ${moneyViewMode === 'month' ? 'bg-white text-slate-800 shadow-sm' : 'text-slate-400'}">Monthly</button>
                                <button onclick="setMoneyViewMode('year')" class="px-3 py-1 rounded-md transition-all ${moneyViewMode === 'year' ? 'bg-white text-slate-800 shadow-sm' : 'text-slate-400'}">Yearly</button>
                            </div>
                        </div>
                        <div class="flex justify-between items-center bg-white p-2 rounded-xl shadow-sm border border-slate-100">
                            <button onclick="changeMoneyDate(-1)" class="p-2 hover:bg-slate-100 rounded-lg">‚Üê</button>
                            <span class="font-bold text-slate-700">${moneyViewMode === 'month' ? moneyViewDate.toLocaleString('default', {month:'long', year:'numeric'}) : moneyViewDate.getFullYear()}</span>
                            <button onclick="changeMoneyDate(1)" class="p-2 hover:bg-slate-100 rounded-lg">‚Üí</button>
                        </div>
                    </div>
                    
                    <div class="flex bg-slate-200 p-1 rounded-xl">
                         <button onclick="setMoneyTab('log')" class="flex-1 py-2 rounded-lg text-sm font-bold transition-all ${moneyTab === 'log' ? 'bg-white shadow text-slate-800' : 'text-slate-500'}">Transactions</button>
                         <button onclick="setMoneyTab('vis')" class="flex-1 py-2 rounded-lg text-sm font-bold transition-all ${moneyTab === 'vis' ? 'bg-white shadow text-slate-800' : 'text-slate-500'}">Visualization</button>
                    </div>

                    ${moneyTab === 'log' ? `
                        <div class="grid grid-cols-3 gap-2">
                             <div class="bg-green-100 p-3 rounded-xl border border-green-200"><p class="text-green-600 text-[10px] font-bold uppercase">In</p><p class="text-green-800 font-bold text-lg">¬£${income.toFixed(0)}</p></div>
                             <div class="bg-red-100 p-3 rounded-xl border border-red-200"><p class="text-red-600 text-[10px] font-bold uppercase">Out</p><p class="text-red-800 font-bold text-lg">¬£${expense.toFixed(0)}</p></div>
                             <div class="bg-slate-100 p-3 rounded-xl border border-slate-200"><p class="text-slate-600 text-[10px] font-bold uppercase">Net</p><p class="font-bold text-lg ${balance>=0?'text-slate-800':'text-red-500'}">¬£${balance.toFixed(0)}</p></div>
                        </div>

                        <div class="bg-white rounded-2xl p-6 shadow-sm border border-pink-100">
                            <div class="flex gap-2 mb-4">
                                <button onclick="setMoneyType('Expense')" class="flex-1 py-2 rounded-lg font-bold text-sm ${moneyTransType==='Expense'?'bg-pink-400 text-white':'bg-slate-100 text-slate-400'}">Expense</button>
                                <button onclick="setMoneyType('Income')" class="flex-1 py-2 rounded-lg font-bold text-sm ${moneyTransType==='Income'?'bg-green-400 text-white':'bg-slate-100 text-slate-400'}">Income</button>
                            </div>
                            <form onsubmit="handleMoneySubmit(event)" class="space-y-4">
                                <div class="flex gap-2">
                                     <div class="relative flex-1">
                                        <input name="amount" type="number" step="0.01" placeholder="0.00" class="w-full pl-8 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-300" required />
                                        <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" id="curr-symbol">¬£</span>
                                     </div>
                                     <select name="currency" onchange="document.getElementById('curr-symbol').textContent = this.value === 'GBP' ? '¬£' : '$'" class="bg-slate-100 rounded-xl px-3 font-medium text-slate-600 focus:outline-none">
                                        <option value="GBP">GBP</option>
                                        <option value="HKD">HKD</option>
                                     </select>
                                </div>
                                <div class="grid grid-cols-2 gap-2">
                                    ${Object.values(cats).map(c => `<button type="button" onclick="setMoneyCat('${c}')" class="p-2 text-xs rounded-lg border transition-all truncate ${moneyCategory === c ? 'bg-slate-800 text-white border-slate-800' : 'border-slate-200 text-slate-500'}">${c}</button>`).join('')}
                                </div>
                                <button type="submit" class="w-full bg-slate-900 text-white py-3 rounded-xl font-bold shadow-lg">Add ${moneyTransType}</button>
                            </form>
                        </div>

                        <div class="space-y-2">
                            ${filtered.map(t => `
                                <div class="flex justify-between items-center bg-white p-3 rounded-xl border border-slate-50 shadow-sm">
                                    <div class="flex items-center gap-3">
                                        <div class="p-2 rounded-full ${t.type === 'Income' ? 'bg-green-100 text-green-600' : 'bg-pink-100 text-pink-600'}">
                                            <i data-lucide="${t.type === 'Income' ? 'coins' : 'pound-sterling'}" width="16"></i>
                                        </div>
                                        <div>
                                            <p class="font-semibold text-slate-700 text-sm">${t.category}</p>
                                            <p class="text-xs text-slate-400">${new Date(t.date).toLocaleDateString()}</p>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-3 text-right">
                                        <div>
                                            <p class="font-bold ${t.type === 'Income' ? 'text-green-600' : 'text-slate-800'}">${t.type==='Income'?'+':'-'} ${t.originalCurrency === 'GBP' ? '¬£' : 'HK$'}${t.originalAmount}</p>
                                            ${t.originalCurrency === 'HKD' ? `<p class="text-[10px] text-slate-400">‚âà ¬£${t.amount.toFixed(2)}</p>` : ''}
                                        </div>
                                        <button onclick="deleteLog('transactions', '${t.id}')" class="text-slate-300 hover:text-red-400 p-2"><i data-lucide="trash-2" width="16"></i></button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : `
                        <div class="w-full bg-white rounded-3xl overflow-hidden shadow-xl shadow-sky-100 border border-slate-100 mt-4">
                            <div class="bg-white px-6 py-4 border-b border-slate-50 flex justify-between items-center">
                                <div class="flex items-center gap-2">
                                    <div class="p-1.5 bg-green-100 rounded-lg"><div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div></div>
                                    <div><h3 class="text-slate-700 text-xs font-bold uppercase tracking-wider">Cash Flow</h3><p class="text-[10px] text-slate-400">Income (Water) ‚Üí Expenses (Vases)</p></div>
                                </div>
                            </div>
                            <div class="relative bg-white"><canvas id="moneyCanvas" class="w-full h-[400px] block"></canvas></div>
                        </div>
                    `}
                </div>
            `;
        }

        // Money State Setters
        window.setMoneyViewMode = (m) => { moneyViewMode = m; render(); };
        window.changeMoneyDate = (d) => { 
            if(moneyViewMode==='month') moneyViewDate.setMonth(moneyViewDate.getMonth()+d); 
            else moneyViewDate.setFullYear(moneyViewDate.getFullYear()+d);
            render(); 
        };
        window.setMoneyTab = (t) => { moneyTab = t; render(); if(t === 'vis') setTimeout(initCanvas, 50); };
        window.setMoneyType = (t) => { 
            moneyTransType = t; 
            moneyCategory = t === 'Income' ? IncomeCategory.POCKET_MONEY : ExpenseCategory.MEALS; 
            render(); 
        };
        window.setMoneyCat = (c) => { moneyCategory = c; render(); };
        window.handleMoneySubmit = (e) => {
            e.preventDefault();
            const form = e.target;
            const val = parseFloat(form.amount.value);
            const curr = form.currency.value;
            store.save('transactions', [{
                id: Date.now().toString(),
                date: new Date().toISOString(),
                type: moneyTransType,
                originalAmount: val,
                originalCurrency: curr,
                amount: curr === 'HKD' ? val * EXCHANGE_RATE : val,
                category: moneyCategory
            }, ...store.data.transactions]);
        };

        // --- CANVAS LOGIC ---
        let animationId;
        function initCanvas() {
            const canvas = document.getElementById('moneyCanvas');
            if(!canvas) return;
            const ctx = canvas.getContext('2d');
            const width = canvas.width = canvas.offsetWidth;
            const height = canvas.height = 400;

            const transactions = store.data.transactions.filter(t => {
                const d = new Date(t.date);
                if (moneyViewMode === 'month') return d.getMonth() === moneyViewDate.getMonth() && d.getFullYear() === moneyViewDate.getFullYear();
                return d.getFullYear() === moneyViewDate.getFullYear();
            });

            const expenses = {};
            Object.values(ExpenseCategory).forEach(c => expenses[c] = 0);
            let income = 0;
            transactions.forEach(t => {
                if(t.type === 'Income') income += t.amount;
                else if (expenses[t.category] !== undefined) expenses[t.category] += t.amount;
            });
            const totalExp = Object.values(expenses).reduce((a,b)=>a+b, 0);

            // Logic Update:
            // 1. Droplets = Income
            // 2. Vase Size = Expense Amount
            // 3. Simulation:
            //    If Income < Expense: Vases fill proportionally (partially).
            //    If Income > Expense: Vases fill completely, overflow to floor.

            const PARTICLE_VAL = Math.max(income, totalExp) > 10000 ? 50 : Math.max(income, totalExp) > 5000 ? 20 : 5;
            
            // Total Particles representing Income
            const totalIncomeParticles = Math.floor(income / PARTICLE_VAL);
            
            // Calculate Vase Capacities (in particles)
            const vaseConfig = {};
            const vases = Object.values(ExpenseCategory);
            const slotW = (width - 30) / vases.length;

            const maxExp = Math.max(1, Math.max(...Object.values(expenses)));

            vases.forEach((v, i) => {
                const amt = expenses[v];
                // Vase physical height depends on expense amount relative to max
                // But visual fill depends on income vs expense
                const h = amt > 0 ? 40 + ((amt / maxExp) * 140) : 0;
                
                // Capacity in particles
                const capacity = Math.ceil(amt / PARTICLE_VAL);

                const vaseW = slotW * 0.85;
                const x = 15 + (i * slotW) + (slotW - vaseW)/2;
                
                vaseConfig[v] = { x, y: height - 30, w: vaseW, h, capacity, fillCount: 0 };
            });

            // Distribute Particles
            let overflowParticles = 0;
            
            if (income >= totalExp) {
                // Fill all vases to capacity
                vases.forEach(v => {
                    vaseConfig[v].fillCount = vaseConfig[v].capacity;
                });
                // Remainder is overflow
                overflowParticles = totalIncomeParticles - Object.values(vaseConfig).reduce((acc, val) => acc + val.capacity, 0);
            } else {
                // Distribute proportional to capacity
                // If I have 50% income coverage, all vases are 50% full
                const ratio = totalExp > 0 ? income / totalExp : 0;
                vases.forEach(v => {
                    vaseConfig[v].fillCount = Math.floor(vaseConfig[v].capacity * ratio);
                });
            }

            const particles = [];
            const TAP_X = width/2;
            const TAP_Y = 50;

            // Generate Vase Particles
            vases.forEach((v, i) => {
                const config = vaseConfig[v];
                if(config.h === 0 || config.fillCount <= 0) return;
                
                // Pack them
                const packSpacing = 6;
                const itemsPerRow = Math.max(1, Math.floor((config.w * 0.8) / packSpacing));
                const centerX = config.x + config.w/2;
                
                for(let j=0; j<config.fillCount; j++) {
                    if(j > 500) break; // limit visual
                    const row = Math.floor(j / itemsPerRow);
                    const col = j % itemsPerRow;
                    const rowW = (Math.min(config.fillCount - row*itemsPerRow, itemsPerRow) - 1) * packSpacing;
                    
                    const tx = centerX - (rowW/2) + (col * packSpacing);
                    const ty = config.y - 5 - (row * packSpacing);
                    
                    // Don't go above rim
                    if(ty < config.y - config.h) break;

                    particles.push({
                        x: TAP_X, y: TAP_Y + 15,
                        tx, ty,
                        vx: (Math.random()-0.5)*5, vy: Math.random()*2,
                        delay: j + (i*10), settled: false,
                        type: 'vase'
                    });
                }
            });

            // Generate Overflow Particles
            const safeOverflow = Math.min(Math.max(0, overflowParticles), 300);
            for(let j=0; j<safeOverflow; j++) {
                const tx = Math.random() * width;
                const ty = height - 30 - Math.random()*10;
                particles.push({
                    x: TAP_X, y: TAP_Y + 15,
                    tx, ty,
                    vx: (Math.random()-0.5)*10, vy: Math.random()*2,
                    delay: 200 + j, settled: false,
                    type: 'floor'
                });
            }

            // --- DRAWING FUNCTIONS ---

            const drawCurvyVase = (ctx, x, bottomY, w, h) => {
                const cx = x + w/2;
                const topY = bottomY - h;
                
                ctx.save();
                ctx.beginPath();
                
                // Styles per reference: Blue dotted pattern
                const patternSize = 4;
                
                // Draw Shape Path
                // Rim
                const rimW = w * 0.7;
                const neckW = w * 0.4;
                const bodyW = w; 
                const baseW = w * 0.6;
                
                ctx.moveTo(cx - rimW/2, topY);
                // Neck curve in
                ctx.bezierCurveTo(cx - rimW/2, topY + h*0.2, cx - neckW/2, topY + h*0.3, cx - neckW/2, topY + h*0.4);
                // Body curve out
                ctx.bezierCurveTo(cx - neckW/2, topY + h*0.6, cx - bodyW/2, topY + h*0.6, cx - bodyW/2, topY + h*0.8);
                // Base curve in
                ctx.bezierCurveTo(cx - bodyW/2, bottomY, cx - baseW/2, bottomY, cx - baseW/2, bottomY);
                // Base line
                ctx.lineTo(cx + baseW/2, bottomY);
                // Mirror right side
                ctx.bezierCurveTo(cx + baseW/2, bottomY, cx + bodyW/2, bottomY, cx + bodyW/2, topY + h*0.8);
                ctx.bezierCurveTo(cx + bodyW/2, topY + h*0.6, cx + neckW/2, topY + h*0.6, cx + neckW/2, topY + h*0.4);
                ctx.bezierCurveTo(cx + neckW/2, topY + h*0.3, cx + rimW/2, topY + h*0.2, cx + rimW/2, topY);
                
                ctx.closePath();
                
                // Fill with light blue
                ctx.fillStyle = '#bae6fd'; // Sky 200
                ctx.fill();
                
                // Clip for dots
                ctx.save();
                ctx.clip();
                ctx.fillStyle = '#3b82f6'; // Blue 500
                for(let py = topY; py < bottomY; py += patternSize*1.5) {
                    const offset = (Math.floor(py/(patternSize*1.5)) % 2) * (patternSize);
                    for(let px = x - w; px < x + w*2; px += patternSize*2) {
                        ctx.beginPath();
                        ctx.arc(px + offset, py, 1, 0, Math.PI*2);
                        ctx.fill();
                    }
                }
                ctx.restore();
                
                // Stroke outline
                ctx.lineWidth = 2;
                ctx.strokeStyle = '#000';
                ctx.stroke();
                
                // Rim Ellipse
                ctx.beginPath();
                ctx.ellipse(cx, topY, rimW/2, 3, 0, 0, Math.PI*2);
                ctx.fillStyle = '#bae6fd';
                ctx.fill();
                ctx.stroke();
                
                ctx.restore();
            };

            const drawSilverTap = (ctx, x, y) => {
                ctx.save();
                ctx.translate(x, y);
                const scale = 0.8;
                ctx.scale(scale, scale);
                
                ctx.lineWidth = 2;
                ctx.strokeStyle = '#334155';
                
                // Base Pipe (Vertical)
                ctx.fillStyle = '#cbd5e1'; // Slate 300
                ctx.beginPath();
                ctx.rect(-10, -30, 20, 30);
                ctx.fill(); ctx.stroke();
                
                // Handle Stem
                ctx.beginPath();
                ctx.rect(-4, -45, 8, 15);
                ctx.fill(); ctx.stroke();
                
                // Handle Turn (Top)
                ctx.fillStyle = '#94a3b8'; // Slate 400
                ctx.beginPath();
                ctx.roundRect(-20, -55, 40, 10, 3);
                ctx.fill(); ctx.stroke();
                
                // Spout Body (Horizontal curve)
                ctx.fillStyle = '#cbd5e1';
                ctx.beginPath();
                ctx.moveTo(-12, -10);
                ctx.lineTo(25, -10);
                ctx.bezierCurveTo(45, -10, 45, 10, 25, 10); // Spout opening
                ctx.lineTo(-12, 10);
                ctx.fill(); ctx.stroke();
                
                // Spout Tip
                ctx.fillStyle = '#64748b';
                ctx.beginPath();
                ctx.ellipse(30, 2, 8, 4, 0, 0, Math.PI*2);
                ctx.fill(); ctx.stroke();
                
                // Water stream start
                // ctx.fillStyle = '#3b82f6';
                // ctx.beginPath();
                // ctx.rect(26, 6, 8, 10);
                // ctx.fill();

                ctx.restore();
            };

            const drawTearDrop = (ctx, x, y, r, color) => {
                ctx.save();
                ctx.translate(x, y);
                ctx.fillStyle = color;
                ctx.strokeStyle = '#1e3a8a';
                ctx.lineWidth = 0.5;
                
                ctx.beginPath();
                // Tear drop shape
                ctx.moveTo(0, -r*1.8); 
                ctx.quadraticCurveTo(r, -r*0.5, r, r*0.5); 
                ctx.arc(0, r*0.5, r, 0, Math.PI); 
                ctx.quadraticCurveTo(-r, -r*0.5, 0, -r*1.8);
                
                ctx.fill();
                ctx.stroke();
                
                // Shine
                ctx.fillStyle = 'rgba(255,255,255,0.6)';
                ctx.beginPath();
                ctx.ellipse(-r*0.3, 0, r*0.15, r*0.4, 0.2, 0, Math.PI*2);
                ctx.fill();
                
                ctx.restore();
            };

            let frame = 0;
            function animate() {
                frame++;
                ctx.clearRect(0,0,width,height);
                
                // Floor
                ctx.beginPath(); ctx.moveTo(0, height-30); ctx.lineTo(width, height-30); 
                ctx.strokeStyle = '#cbd5e1'; ctx.lineWidth = 2; ctx.stroke();

                // Vases
                vases.forEach((v, i) => {
                   const config = vaseConfig[v];
                   if(config.h > 0) {
                       drawCurvyVase(ctx, config.x, height-30, config.w, config.h);
                   } else {
                       ctx.fillStyle = '#94a3b8';
                       ctx.font = '9px Inter';
                       ctx.textAlign = 'center';
                       ctx.fillText(v.split(' ')[0], config.x + config.w/2, height - 15);
                   }
                });

                // Particles
                particles.forEach(p => {
                    if(frame < p.delay) return;
                    if(!p.settled) {
                        p.vy += 0.2;
                        p.x += (p.tx - p.x) * 0.08;
                        p.y += p.vy;
                        
                        if(p.y >= p.ty) { p.y = p.ty; p.settled = true; }
                    }
                    drawTearDrop(ctx, p.x, p.y, 3, '#3b82f6');
                });

                // Tap
                drawSilverTap(ctx, TAP_X, TAP_Y);

                // Labels
                vases.forEach((v) => {
                    const config = vaseConfig[v];
                    if(config.h > 0) {
                        const amt = expenses[v];
                        const cx = config.x + config.w/2;
                        const topY = height - 30 - config.h;
                        
                        ctx.font = 'bold 9px Inter';
                        const txt = '¬£' + amt.toFixed(0);
                        const tm = ctx.measureText(txt);
                        ctx.fillStyle = 'rgba(255,255,255,0.8)';
                        ctx.fillRect(cx - tm.width/2 - 2, topY - 12, tm.width + 4, 10);
                        ctx.fillStyle = '#166534';
                        ctx.textAlign = 'center';
                        ctx.fillText(txt, cx, topY - 4);
                        
                        ctx.fillStyle = '#475569';
                        ctx.fillText(v.split(' ')[0], cx, height - 15);
                    }
                });
                
                // Info Overlay
                ctx.textAlign = 'left';
                ctx.font = 'bold 12px Inter';
                ctx.fillStyle = '#059669'; 
                ctx.fillText(`Income (Droplets): ¬£${income.toFixed(0)}`, 20, 20);
                ctx.fillStyle = '#dc2626'; 
                ctx.fillText(`Expense (Vases): ¬£${totalExp.toFixed(0)}`, 20, 36);

                if(animationId) animationId = requestAnimationFrame(animate);
            }
            if(animationId) cancelAnimationFrame(animationId);
            animationId = requestAnimationFrame(animate);
        }

        // --- VIEW: BANK ---
        function getBankHTML() {
            return `
                <div class="space-y-6">
                    <div class="bg-gradient-to-r from-sky-500 to-blue-600 rounded-2xl p-6 text-white shadow-lg shadow-sky-200">
                        <h2 class="text-xl font-bold flex items-center gap-2"><i data-lucide="droplets"></i> Droplet Savings</h2>
                        <p class="text-3xl font-bold mt-4">${store.data.ponds.reduce((a,b)=>a+b.droplets, 0)}<span class="text-base font-normal opacity-75 ml-2">total</span></p>
                    </div>
                    <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-100">
                        <form onsubmit="handleAddPond(event)" class="flex gap-2">
                            <input name="name" type="text" placeholder="New Pond Name..." class="flex-1 px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none" required />
                            <button type="submit" class="bg-sky-500 text-white p-3 rounded-xl"><i data-lucide="plus"></i></button>
                        </form>
                    </div>
                    <div class="space-y-4">
                        ${store.data.ponds.map(p => `
                            <div class="bg-white rounded-2xl p-5 shadow-sm border border-slate-100 relative overflow-hidden">
                                <div class="flex justify-between mb-4 relative z-10">
                                    <h3 class="text-lg font-bold text-slate-700">${p.name}</h3>
                                    <button onclick="deleteLog('ponds', '${p.id}')" class="text-slate-300 hover:text-red-400"><i data-lucide="trash-2" width="16"></i></button>
                                </div>
                                <div class="flex justify-between items-center relative z-10">
                                    <div class="flex items-center gap-2 bg-slate-50 rounded-xl p-1">
                                        <button onclick="updateDroplets('${p.id}', -1)" class="w-10 h-10 flex items-center justify-center bg-white rounded-lg shadow-sm text-slate-400"><i data-lucide="minus" width="16"></i></button>
                                        <input type="number" value="${p.droplets}" onchange="setDroplets('${p.id}', this.value)" class="w-16 h-10 text-center font-bold text-xl bg-transparent focus:outline-none text-sky-600" />
                                        <button onclick="updateDroplets('${p.id}', 1)" class="w-10 h-10 flex items-center justify-center bg-sky-500 rounded-lg shadow-sm text-white"><i data-lucide="plus" width="16"></i></button>
                                    </div>
                                    <div class="flex text-sky-400">
                                        ${Array.from({length: Math.min(5, Math.max(0, p.droplets))}).map(()=>`<i data-lucide="droplets" width="16" class="fill-current"></i>`).join('')}
                                        ${p.droplets > 5 ? '...' : ''}
                                    </div>
                                </div>
                                ${p.droplets > 0 ? `<div class="absolute bottom-0 left-0 h-1 bg-sky-500 transition-all" style="width: ${Math.min(100, p.droplets*2)}%"></div>` : ''}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        window.handleAddPond = (e) => {
            e.preventDefault();
            const name = e.target.name.value;
            store.save('ponds', [{id: Date.now().toString(), name, droplets: 0}, ...store.data.ponds]);
        };
        window.updateDroplets = (id, d) => {
            store.save('ponds', store.data.ponds.map(p => p.id === id ? {...p, droplets: p.droplets + d} : p));
        };
        window.setDroplets = (id, v) => {
            store.save('ponds', store.data.ponds.map(p => p.id === id ? {...p, droplets: parseInt(v) || 0} : p));
        };

        // --- GLOBAL ACTIONS ---
        window.deleteLog = (key, id) => {
            store.save(key, store.data[key].filter(i => i.id !== id));
        };

        // --- MAIN RENDER ---
        function render() {
            const app = document.getElementById('app');
            renderNav();
            renderAlert();
            
            // Clean up old canvas animation if changing away from Money tab or Vis view
            if(animationId && (store.data.activeTab !== 'money' || moneyTab !== 'vis')) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }

            switch(store.data.activeTab) {
                case 'summary': app.innerHTML = getSummaryHTML(); break;
                case 'weight': app.innerHTML = getWeightHTML(); break;
                case 'diet': app.innerHTML = getDietHTML(); break;
                case 'exercise': app.innerHTML = getExerciseHTML(); break;
                case 'money': app.innerHTML = getMoneyHTML(); break;
                case 'bank': app.innerHTML = getBankHTML(); break;
            }
            
            // Refresh Icons
            lucide.createIcons();
            
            // Trigger Money Canvas if needed
            if(store.data.activeTab === 'money' && moneyTab === 'vis') {
                setTimeout(initCanvas, 50);
            }
        }

        // Initial Render
        render();

    </script>
</body>
</html>
